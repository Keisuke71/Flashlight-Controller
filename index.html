<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewpoet" content="width=device-width", initial-scale="1.0">
    <title>ライト操作</title>
</head>
<body>
    <button id="btn" style="padding:20px; font-size:20px";>ライトON/OFF</button>
    <p>※カメラの許可を求めたら「許可」を押してください</p>
    <script> //ボタンのスクリプト
        const btn = document.getElementById('btn'); 
        let track = null;
        let islightON = false;

        btn.addEventListener('click', async () => {
            // まだカメラ権限を取得してない場合
            if(!track) {
                try {
                    //バックカメラの映像ストリームを取得
                    const stream = await
                    navigator.mediaDevices.getUserMedia({
                        video: {
                            facingMode: 'environment',
                            //ここでtorchがあるか確認する機能をいれてもいい
                        }
                    });
                    track = stream.getVideoTracks()[0];

                    //取得できたトラックの機能にtorchが含まれているか確認
                    const capabilities = track.getCapabilities();
                    if(!capabilities.torch) {
                        alert("この端末はWebからのライト操作に対応していません。");
                        return;
                    }
                } catch (err) {
                    alert("カメラへのアクセスが拒否されたか、エラーが発生しました。");
                }
            }
            //ライトのON/OFF切り替え
            islightON = !islightON;
            try{
                await track.applyConstrains({
                    advanced: [{ torch: islightON}]
                });
                btn.textContent = islightON ? "ライトOFF" : "ライトON";
            } catch(err) {
                console.error(err);
                alert("ライトの操作に失敗しました。");
            }
        });
    </script>
</body>
</html>