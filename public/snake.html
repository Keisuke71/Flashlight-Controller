<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã•ã‚‰ã«æš‡ãªäººç”¨ã‚¹ãƒãƒ¼ã‚¯</title>
    <style>
        body {
            background-color: #222; color: white;
            font-family: sans-serif; text-align: center;
            touch-action: none; /* ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’é˜²ã */
            overscroll-behavior: none;
        }
        h2 { margin: 10px 0; color: #2ecc71; }
        #game-container {
            margin: 0 auto;
            display: inline-block;
        }
        canvas {
            background-color: #333;
            border: 2px solid #555;
            border-radius: 5px;
            display: block; /* éš™é–“ã‚’ãªãã™ */
        }
        .info { font-size: 1.2em; margin: 5px; }
        #startBtn {
            padding: 10px 30px; font-size: 1.2em;
            background: #27ae60; color: white; border: none; border-radius: 8px;
            margin-top: 15px; cursor: pointer;
        }
        .back-link {
            display: block; margin-top: 20px; color: #aaa; text-decoration: none; padding: 10px;
        }
        p.hint { font-size: 0.8em; color: #aaa; margin-bottom: 5px;}
    </style>
</head>
<body>

    <h2>ğŸ ã‚¹ãƒãƒ¼ã‚¯ã‚²ãƒ¼ãƒ </h2>
    <p class="hint">PCã¯çŸ¢å°ã‚­ãƒ¼ã€ã‚¹ãƒãƒ›ã¯ãƒ•ãƒªãƒƒã‚¯æ“ä½œ</p>
    <div class="info">ã‚¹ã‚³ã‚¢: <span id="score">0</span></div>

    <div id="game-container">
        <canvas id="gameCanvas" width="300" height="300"></canvas>
    </div>
    
    <br>
    <button id="startBtn" onclick="startGame()">ã‚²ãƒ¼ãƒ ã‚¹ã‚¿ãƒ¼ãƒˆ</button>

    <a href="/game.html" class="back-link">â† ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¿ãƒƒãƒã«æˆ»ã‚‹</a>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const startBtn = document.getElementById('startBtn');

        const GRID_SIZE = 15; // ãƒã‚¹ã®å¤§ãã•
        const TILE_COUNT = canvas.width / GRID_SIZE; // 1è¾ºã®ãƒã‚¹æ•°(20å€‹)
        
        let snake = [];
        let food = {};
        let dx = 0;
        let dy = 0;
        let score = 0;
        let gameLoop = null;
        let isGameOver = false;

        // --- æ“ä½œé–¢é€£ (ã‚¹ãƒãƒ›å¯¾å¿œ) ---
        let touchStartX = 0;
        let touchStartY = 0;

        document.addEventListener('keydown', changeDirection);
        canvas.addEventListener('touchstart', e => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
            e.preventDefault();
        }, {passive: false});
        
        canvas.addEventListener('touchmove', e => {
            if (isGameOver) return;
            e.preventDefault();
            const touchEndX = e.changedTouches[0].clientX;
            const touchEndY = e.changedTouches[0].clientY;
            const diffX = touchEndX - touchStartX;
            const diffY = touchEndY - touchStartY;

            // ç§»å‹•é‡ãŒå°‘ãªã„å ´åˆã¯ç„¡è¦–ï¼ˆã‚¿ãƒƒãƒ—èª¤çˆ†é˜²æ­¢ï¼‰
            if (Math.abs(diffX) < 30 && Math.abs(diffY) < 30) return;

            // ã‚ˆã‚Šå¤§ããå‹•ã‹ã—ãŸæ–¹å‘ã‚’æ¤œçŸ¥
            if (Math.abs(diffX) > Math.abs(diffY)) {
                if (diffX > 0 && dx === 0) { dx = 1; dy = 0; } // å³
                else if (diffX < 0 && dx === 0) { dx = -1; dy = 0; } // å·¦
            } else {
                if (diffY > 0 && dy === 0) { dx = 0; dy = 1; } // ä¸‹
                else if (diffY < 0 && dy === 0) { dx = 0; dy = -1; } // ä¸Š
            }
            // é€£ç¶šå…¥åŠ›é˜²æ­¢ã®ãŸã‚é–‹å§‹ç‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            touchStartX = touchEndX;
            touchStartY = touchEndY;
        }, {passive: false});


        function startGame() {
            if (gameLoop) clearInterval(gameLoop);
            snake = [{x: 10, y: 10}]; // åˆæœŸä½ç½®
            dx = 1; dy = 0; // æœ€åˆã¯å³ã¸
            score = 0;
            isGameOver = false;
            scoreDisplay.textContent = score;
            startBtn.style.display = 'none';
            placeFood();
            // 100msã”ã¨ã«ç”»é¢ã‚’æ›´æ–°ï¼ˆã‚¹ãƒ”ãƒ¼ãƒ‰ï¼‰
            gameLoop = setInterval(update, 100);
        }

        function update() {
            if (isGameOver) return;
            moveSnake();
            checkCollision();
            draw();
        }

        function moveSnake() {
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };
            snake.unshift(head); // é ­ã‚’è¿½åŠ 

            // ã‚¨ã‚µã‚’é£Ÿã¹ãŸã‹ç¢ºèª
            if (head.x === food.x && head.y === food.y) {
                score++;
                scoreDisplay.textContent = score;
                placeFood();
            } else {
                snake.pop(); // é£Ÿã¹ã¦ãªã‘ã‚Œã°å°»å°¾ã‚’å‰Šé™¤
            }
        }

        function checkCollision() {
            const head = snake[0];
            // å£è¡çª
            if (head.x < 0 || head.x >= TILE_COUNT || head.y < 0 || head.y >= TILE_COUNT) {
                gameOver();
            }
            // è‡ªåˆ†è‡ªèº«ã«è¡çªï¼ˆé ­ä»¥å¤–ã¨é‡ãªã£ãŸã‚‰ï¼‰
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) {
                    gameOver();
                }
            }
        }

        function gameOver() {
            isGameOver = true;
            clearInterval(gameLoop);
            startBtn.style.display = 'inline-block';
            startBtn.textContent = "ã‚‚ã†ä¸€å›éŠã¶";
            ctx.fillStyle = 'rgba(0,0,0,0.5)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = '20px Arial';
            ctx.textAlign = 'center';
            ctx.fillText("Game Over", canvas.width / 2, canvas.height / 2);
        }

        function draw() {
            // ç”»é¢ã‚¯ãƒªã‚¢
            ctx.fillStyle = '#333';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // ã‚¨ã‚µæç”»
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(food.x * GRID_SIZE, food.y * GRID_SIZE, GRID_SIZE - 1, GRID_SIZE - 1);

            // ãƒ˜ãƒ“æç”»
            ctx.fillStyle = '#2ecc71';
            snake.forEach((segment, index) => {
                // é ­ã¯å°‘ã—è‰²ã‚’å¤‰ãˆã‚‹
                if (index === 0) ctx.fillStyle = '#27ae60';
                else ctx.fillStyle = '#2ecc71';
                ctx.fillRect(segment.x * GRID_SIZE, segment.y * GRID_SIZE, GRID_SIZE - 1, GRID_SIZE - 1);
            });
        }

        function placeFood() {
            food = {
                x: Math.floor(Math.random() * TILE_COUNT),
                y: Math.floor(Math.random() * TILE_COUNT)
            };
            // ãƒ˜ãƒ“ã®ä¸Šã«ã‚¨ã‚µãŒå‡ºãªã„ã‚ˆã†ã«ã™ã‚‹ç°¡å˜ãªå¯¾ç­–
            snake.forEach(segment => {
                if (segment.x === food.x && segment.y === food.y) placeFood();
            });
        }

        function changeDirection(e) {
            if (isGameOver) return;
            const key = e.keyCode;
            // é€†æ–¹å‘ã«ã¯é€²ã‚ãªã„ã‚ˆã†ã«åˆ¶é™
            if (key === 37 && dx === 0) { dx = -1; dy = 0; } // å·¦
            else if (key === 38 && dy === 0) { dx = 0; dy = -1; } // ä¸Š
            else if (key === 39 && dx === 0) { dx = 1; dy = 0; } // å³
            else if (key === 40 && dy === 0) { dx = 0; dy = 1; } // ä¸‹
        }

        // åˆæœŸæç”»
        draw();
    </script>
</body>
</html>